name: CI

on:
  push:
    branches:
      - 'master'
      - 'develop'
      - 'bugfix/*'
      - 'feature/*'
      - 'release/*'
  pull_request:
    branches:
      - 'develop'
      - 'master'

jobs:
  travis-ci-migration:
    name: ${{ matrix.run-job }}
    runs-on: ${{ matrix.machine }}
    continue-on-error: ${{ matrix.experimental }}

    strategy:
      fail-fast: false
      matrix:
        machine: ['ubuntu-18.04']
        php-version: ['7.2']
        run-job: ['SH lint', 'Buildsh', 'Bash Autocompletion', 'Magento 1.9.4.5 PHP 7.2']
        experimental: [false]
        include:
          - machine: 'ubuntu-18.04'
            php-version: '7.3'
            run-job: 'OpenMage LTS 20.0.3 PHP 7.3'
            experimental: false

    env:
      SETUP_DB_PASS: root

    steps:
      - uses: actions/checkout@v2
      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-version }}
          coverage: none

      - {name: mysqld,shell: bash,run: 'sudo systemctl start mysql.service'}
      - uses: ktomk/run-travis-yml@v1
        with:
          run_job: ${{ matrix.run-job }}
